<%- include('partials/header') %>

<main class="container py-5">

  <div class="text-center text-white mb-5">
    <h1 class="fw-bold">Raffle Center</h1>
    <p class="text-white-50">Gunakan Poin Anda untuk bergabung dan menangkan hadiah menarik!</p>
  </div>

  <h4 class="text-white mb-3 fw-bold">Raffle yang Sedang Berlangsung</h4>
  <div class="row g-4 mb-5">
    <% if (raffles.length > 0) { %>
      <% raffles.forEach(r => { %>
        <div class="col-md-6 col-lg-4">
          <div class="card bg-dark text-white h-100 shadow rounded-3 border-0">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title text-primary fw-bold"><%= r.title %></h5>
              <p class="card-text text-white-50">Menangkan: <span class="fw-bold"><%= r.reward %></span></p>
              <p class="card-text text-white-50 small">Diundi pada: <%= new Date(r.draw_date).toLocaleDateString('id-ID', { day: '2-digit', month: 'long', year: 'numeric' }) %></p>
              
              <form action="/raffles/<%= r.id %>/join" method="POST" class="mt-auto">
                <button type="submit" class="btn btn-primary w-100 fw-bold">
                  <i class="bi bi-ticket-perforated me-2"></i>Ikut (100 Poin)
                </button>
              </form>
            </div>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <div class="col">
        <div class="card bg-dark text-white shadow rounded-3 border-0">
          <div class="card-body text-center p-5">
            <i class="bi bi-search fs-1 text-secondary"></i>
            <p class="text-white-50 mt-3">Saat ini belum ada raffle yang aktif.</p>
          </div>
        </div>
      </div>
    <% } %>
  </div>

  <div class="row g-4">
    <div class="col-lg-7">
      <div class="card bg-dark text-white h-100 shadow rounded-3 border-0">
        <div class="card-body p-4">
          <h5 class="card-title fw-bold mb-4">Tiket Raffle Saya</h5>
          <% if (myTickets.length > 0) { %>
            <div class="table-responsive">
              <table class="table table-dark table-hover align-middle">
                <thead>
                  <tr>
                    <th>Raffle</th>
                    <th>Waktu Bergabung</th>
                  </tr>
                </thead>
                <tbody>
                  <% myTickets.forEach(t => { %>
                    <tr>
                      <td class="fw-bold"><%= t.raffle_title %></td>
                      <td class="text-white-50"><%= new Date(t.created_at).toLocaleString("id-ID") %></td>
                    </tr>
                  <% }) %>
                </tbody>
              </table>
            </div>
          <% } else { %>
            <div class="text-center p-5">
              <i class="bi bi-ticket fs-1 text-secondary"></i>
              <p class="text-white-50 mt-3">Anda belum memiliki tiket raffle.</p>
            </div>
          <% } %>
        </div>
      </div>
    </div>

    <div class="col-lg-5">
      <div class="card bg-dark text-white h-100 shadow rounded-3 border-0">
        <div class="card-body p-4">
          <h5 class="card-title fw-bold mb-4">Pemenang Terakhir</h5>
          <% if (winners.length > 0) { %>
            <ul class="list-group list-group-flush">
              <% winners.forEach(w => { %>
                <li class="list-group-item bg-dark text-white d-flex justify-content-between align-items-center">
                  <div>
                    <i class="bi bi-trophy-fill text-warning me-2"></i>
                    <span class="fw-bold"><%= w.username %></span>
                  </div>
                  <span class="text-white-50">Mendapatkan <%= w.reward %></span>
                </li>
              <% }) %>
            </ul>
          <% } else { %>
            <div class="text-center p-5">
              <i class="bi bi-trophy fs-1 text-secondary"></i>
              <p class="text-white-50 mt-3">Belum ada pemenang yang diumumkan.</p>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>

</main>

<%- include('partials/footer') %>